<!DOCTYPE html>
<html style="height: 100%">

<head>
    <meta charset="utf-8">
</head>

<body style="height: 100%; margin: 0">
    <div id="container" style="height: 100%"></div>
    <script type="text/javascript" src="./js/echarts.min.js"></script>
    <script type="text/javascript" src="./js/echarts-gl.min.js"></script>
    <script type="text/javascript" src="./js/ecStat.min.js"></script>
    <script type="text/javascript" src="./js/dataTool.min.js"></script>
    <script type="text/javascript" src="./js/china.js"></script>
    <script type="text/javascript" src="./js/world.js"></script>
    <script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=ZUONbpqGBsYGXNIYHicvbAbM"></script>
    <script type="text/javascript" src="./js/bmap.min.js"></script>
    <script type="text/javascript" src="./js/simplex.js"></script>
    <script type="text/javascript">
        var dom = document.getElementById("container");
        var myChart = echarts.init(dom);
        var app = {};
        option = null;

        var data = [
            { name: '湖口', value: 150, date: '1993.06.18' },     // 张小泽
            { name: '嘉兴', value: 150, date: '1991.03.27' },     // 艳小胖
            { name: '北京', value: 150, date: '2014.09.01' },     // 研究生
            { name: '安吉', value: 120, date: '2015.02.13' },     // 15.2 旅游
            { name: '大同', value: 100, date: '2015.04' },     // 15.4 旅游
            { name: '郑州', value: 100, date: '2015.06.18' },     // 15.6 开会
            { name: '秦皇岛', value: 100, date: '2015.06' },   // 15.6 毕业旅行
            { name: '蓬莱', value: 100, date: '2015.08' },     // 15.8 实践
            { name: '烟台', value: 100, date: '2015.08' },     // 15.8 实践
            { name: '西安', value: 100, date: '2016.01' },     // 16.1 旅游
            { name: '昌黎', value: 100, date: '2016.05' },     // 16.5 旅游
            { name: '承德', value: 100, date: '2016.06' },     // 16.6 毕业旅行
            { name: '雅安', value: 100, date: '2016.07' },     // 16.7 实践
            { name: '重庆', value: 100, date: '2016.08' },     // 16.8 旅游
            { name: '成都', value: 100, date: '2016.08' },     // 16.8 旅游
            { name: '大理', value: 100, date: '2017.05' },     // 17.5 旅游
            { name: '丽江', value: 100, date: '2017.05' },     // 17.5 旅游
            { name: '杭州', value: 200, date: '现在' },     // now
            { name: '石浦', value: 100, date: '2018.07' },     // 看望爸妈
            { name: '泰兴', value: 100, date: '2017.10' },     // 康妹婚礼
            { name: '绍兴', value: 100, date: '-' },
        ];

        var path = [
            [{ name: '湖口' }, { name: '北京', value: 100 }],
            [{ name: '嘉兴' }, { name: '北京', value: 100 }],
            [{ name: '北京' }, { name: '大同', value: 100 }],
            [{ name: '北京' }, { name: '郑州', value: 100 }],
            [{ name: '北京' }, { name: '秦皇岛', value: 100 }],
            [{ name: '烟台' }, { name: '蓬莱', value: 100 }],
            [{ name: '北京' }, { name: '烟台', value: 100 }],
            [{ name: '北京' }, { name: '西安', value: 100 }],
            [{ name: '北京' }, { name: '昌黎', value: 100 }],
            [{ name: '北京' }, { name: '承德', value: 100 }],
            [{ name: '成都' }, { name: '雅安', value: 100 }],
            [{ name: '成都' }, { name: '重庆', value: 100 }],
            [{ name: '北京' }, { name: '成都', value: 100 }],
            [{ name: '北京' }, { name: '大理', value: 100 }],
            [{ name: '大理' }, { name: '丽江', value: 100 }],
            [{ name: '北京' }, { name: '杭州', value: 100 }],
            [{ name: '湖口' }, { name: '杭州', value: 100 }],
            [{ name: '嘉兴' }, { name: '杭州', value: 100 }],
            [{ name: '杭州' }, { name: '石浦', value: 100 }],
            [{ name: '杭州' }, { name: '安吉', value: 100 }],
            [{ name: '杭州' }, { name: '泰兴', value: 100 }],
            [{ name: '杭州' }, { name: '绍兴', value: 100 }],


        ];

        var geoCoordMap = {
            '湖口': [115.999848021554, 29.7196395261224],
            '嘉兴': [120.760427698957, 30.7739922395818],
            '北京': [116.395645037879, 39.9299857780802],
            '安吉': [119.583157926268, 30.6263704943341],
            '大同': [113.3, 40.12],
            '郑州': [113.649643849864, 34.7566100641403],
            '蓬莱': [120.862694281839, 37.6611604108342],
            '烟台': [121.309555030085, 37.5365615628596],
            '秦皇岛': [119.604367616118, 39.9454615658976],
            '西安': [108.95, 34.27],
            '昌黎': [119.094621497382, 39.6380211647284],
            '承德': [117.933822455838, 40.9925210524571],
            '雅安': [103.009356466347, 29.9997163370658],
            '重庆': [106.530635013413, 29.5446061088861],
            '成都': [104.067923463304, 30.6799428454196],
            '大理': [100.219208954218, 25.693966622473],
            '丽江': [100.229628398879, 26.8753510894814],
            '杭州': [120.21937541572, 30.2592444615361],
            '石浦': [120.836624214548, 27.9311509962931],
            '泰兴': [120.13534629200471, 32.213678940627226],
            '绍兴': [120.59246738555154, 30.00236458052847],
        };

        var convertData = function (data) {
            var res = [];
            for (var i = 0; i < data.length; i++) {
                var geoCoord = geoCoordMap[data[i].name];
                if (geoCoord) {
                    res.push({
                        name: data[i].name,
                        value: geoCoord.concat(data[i].value),
                        date: data[i].date
                    });
                }
            }
            return res;
        };

        var converPath = function (data) {
            var res = [];
            for (var i = 0; i < data.length; i++) {
                var dataItem = data[i];
                var fromCoord = geoCoordMap[dataItem[0].name];
                var toCoord = geoCoordMap[dataItem[1].name];
                if (fromCoord && toCoord) {
                    res.push({
                        fromName: dataItem[0].name,
                        toName: dataItem[1].name,
                        coords: [fromCoord, toCoord]
                    });
                }
            }
            return res;
        }

        console.log(convertData(data));
        console.log(converPath(path));

        option = {
            backgroundColor: '#044161',
            title: {
                text: 'OUR ROAD',
                subtext: '',
                sublink: '',
                top: '20',
                left: 'center',
                textStyle: {
                    color: '#b8f1ed',
                    fontSize: '26',
                    fontFamily: 'Menlo'
                },
                subtextStyle: {
                    color: '#f1b8e4',
                    fontSize: '18',
                }
            },
            tooltip: {
                trigger: 'item'
            },
            geo: {
                map: 'china',
                label: {
                    emphasis: {
                        show: false
                    }
                },
                roam: true,
                zoom: 1.2,
                center: [104, 36],
                itemStyle: {
                    normal: {
                        areaColor: '#014881',
                        borderColor: '#029FD4'
                    },
                    emphasis: {
                        areaColor: '#014881'
                    }
                }
            },
            series: [
                {
                    name: '时间',
                    type: 'scatter',
                    coordinateSystem: 'geo',
                    data: convertData(data),
                    symbolSize: function (val) {
                        return val[2] / 10;
                    },

                    label: {
                        normal: {
                            formatter: '{b}',
                            position: 'right',
                            show: true
                        },
                        // emphasis: {
                        //     show: true
                        // }
                    },
                    itemStyle: {
                        normal: {
                            color: '#ddb926'
                        }
                    },
                    tooltip: {
                        formatter: (params) => {
                            return params.data.date;
                        },
                    }

                },
                {
                    name: '时间',
                    type: 'effectScatter',
                    coordinateSystem: 'geo',
                    data: convertData(data.sort(function (a, b) {
                        return b.value - a.value;
                    }).slice(0, 4)),
                    symbolSize: function (val) {
                        return val[2] / 15;
                    },
                    showEffectOn: 'render',
                    rippleEffect: {
                        brushType: 'stroke'
                    },
                    hoverAnimation: true,
                    label: {
                        normal: {
                            formatter: '{b}',
                            position: 'right',
                            show: true
                        }
                    },
                    itemStyle: {
                        normal: {
                            color: '#f4e925',
                            shadowBlur: 10,
                            shadowColor: '#333'
                        }
                    },
                    tooltip: {
                        formatter: (params) => {
                            return params.data.date;
                        },
                    },
                    zlevel: 1
                },
                {
                    name: 'path',
                    type: 'lines',
                    zlevel: 0,
                    effect: {
                        show: true,
                        period: 6,
                        trailLength: 0.7,
                        color: '#b8f1ed',
                        symbolSize: 3
                    },
                    lineStyle: {
                        normal: {
                            color: '#b8f1ed',
                            width: 1,
                            opacity: 0.6,
                            curveness: 0.2
                        }
                    },
                    data: converPath(path),
                    tooltip: {
                        formatter: '{b}',
                    },
                }
            ]
        };;
        if (option && typeof option === "object") {
            myChart.setOption(option, true);
        }
    </script>
</body>

</html>